  <%= form_with(model: @revision, url: {action: "update", inspection_id: @inspection.id}, local: true, multipart: true) do |form| %>
    <% if @revision.errors.any? %>
      <div style="color: red">
        <h2><%= pluralize(@revision.errors.count, "error") %> No se pudo guardar la revisión:</h2>

        <ul>
          <% @revision.errors.each do |error| %>
            <li><%= error.full_message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <% @revision.group.rules.each_with_index do |rule, index| %>
      <div data-controller="rules-form">
        <% is_checked = @revision.codes.include?(rule.code) && @revision.points.include?(rule.point) %>
        <%= check_box_tag "revision[fail][]", "1", is_checked, id: "fail_#{index}", data: { action: "change->rules-form#toggle", rules_form_target: "fail" } %>
        <%= label_tag "fail_#{index}", "Falla #{rule.code} #{rule.point} #{rule.level}" %>

        <%= hidden_field_tag "revision[codes][]", rule.code, data: { rules_form_target: "code" } %>
        <%= hidden_field_tag "revision[points][]", rule.point, data: { rules_form_target: "point" } %>
        <%= hidden_field_tag "revision[levels][]", rule.level, data: { rules_form_target: "level" } %>

        <%= label_tag "revision_photos[photo][]", "Upload Photo for #{rule.code}" %>
        <%= file_field_tag "revision_photos[photo][]", name: "revision_photos[photo][]", id: "photo_#{index}", disabled: !is_checked, data: { rules_form_target: "photo" } %>
        <%= text_area_tag "revision[comment][]", nil, data: { rules_form_target: "comment" } %>
        <%= hidden_field_tag "revision_photos[code][]", rule.code, data: { rules_form_target: "photoCode" } %>
      </div>
    <% end %>

    <div>
      <%= form.submit %>
    </div>
  <% end %>

  <div>
    <%= link_to "Volver atrás", @revision %> |
  </div>
