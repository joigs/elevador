<%= form_with(model: @revision, url: {action: "update", inspection_id: @inspection.id}, local: true, multipart: true) do |form| %>
  <% if @revision.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(@revision.errors.count, "error") %> No se pudo guardar la revisión:</h2>

      <ul>
        <% @revision.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <% @revision.group.rules.each_with_index do |rule, index| %>
    <div>


      <%if @revision.codes.include?(rule.code) and @revision.points.include?(rule.point) %>
          <%= check_box_tag "revision[fail][]", "1", true, id: "fail_#{index}" %>
      <% else %>
        <%= check_box_tag "revision[fail][]", "1", false, id: "fail_#{index}" %>
      <% end %>
      <%= hidden_field_tag "revision[fail][]", "0" %>

      <!-- Hidden field first -->
      <%= label_tag "fail_#{index}", "Falla #{rule.code} #{rule.point} #{rule.level}" %>
      <%= hidden_field_tag "revision[codes][]", rule.code %>
      <%= hidden_field_tag "revision[points][]", rule.point %>
      <%= hidden_field_tag "revision[levels][]", rule.level %>

      <!-- carga de imagenes -->
      <%= label_tag "revision_photos[photo][]", "Upload Photo for #{rule.code}" %>
      <%= file_field_tag "revision_photos[photo][]", name: "revision_photos[photo][]", id: "photo_#{index}" %>

      <%= hidden_field_tag "revision_photos[code][]", rule.code %>
    </div>
  <% end %>


  <div>
    <%= form.submit %>
  </div>
<% end %>

<div>
  <%= link_to "Volver atrás", @revision %> |
</div>
