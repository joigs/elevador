

<% years = ((Date.current.year - 5)..(Date.current.year + 1)).to_a.reverse %>
<% selected_year_experiencia = (Date.current.year).to_i %>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-6">
  <h1> Listado certificados </h1>
  <%= form_with url: certificados_excel_graficos_path,
                method: :get,
                local: true,
                data: { turbo: false },
                target: "_blank",
                authenticity_token: false,
                class: "bg-gray-800/70 border border-gray-700 rounded-xl p-4 sm:p-6 shadow" do %>
    <div class="flex flex-col sm:flex-row items-stretch sm:items-end gap-4">
      <div class="w-full sm:w-56">
        <label for="year" class="block text-sm font-medium text-black mb-1">Año</label>
        <%= select_tag :year,
                       options_for_select(years, selected_year_experiencia),
                       id: 'year',
                       class: "block w-full rounded-lg border border-gray-600 bg-gray-900 text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 py-2.5 pl-3 pr-8 cursor-pointer" %>
      </div>
      <div class="shrink-0">
        <%= submit_tag 'Descargar Excel',
                       class: "inline-flex items-center rounded-lg bg-blue-600 px-4 py-2.5 text-sm font-semibold text-white shadow hover:bg-blue-500 focus:outline-none focus:ring-4 focus:ring-blue-500/30 cursor-pointer" %>
      </div>
    </div>
  <% end %>
</div>


<% if @inspections.any? %>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 my-8">
    <div class="bg-gray-800 shadow overflow-hidden sm:rounded-md">
      <div class="mb-6 flex space-x-4 justify-center py-4">
        <%= link_to 'Gráfico de Barra',
                    graficos_path(chart_type: 'bar', year: @selected_year),
                    data: { turbo_frame: 'chart_frame' },
                    class: "px-4 py-2 rounded #{params[:chart_type] == 'bar' ? 'bg-blue-500 text-white' : 'bg-gray-500 text-gray-200'} hover:bg-blue-600 transition duration-300" %>
        <%= link_to 'Gráfico de Torta',
                    graficos_path(chart_type: 'pie', year: @selected_year),
                    data: { turbo_frame: 'chart_frame' },
                    class: "px-4 py-2 rounded #{params[:chart_type] == 'pie' ? 'bg-blue-500 text-white' : 'bg-gray-500 text-gray-200'} hover:bg-blue-600 transition duration-300" %>
      </div>
      <%= turbo_frame_tag 'content_frame2' do %>
        <%= render 'statistics_chart', chart_type: @chart_type %>
      <% end %>
    </div>
  </div>
<% else %>

  <div class="p-6 flex justify-center">
    <p class="text-gray-300">No existen inspecciones registradas para esta empresa.</p>
  </div>
<% end %>