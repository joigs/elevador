<!-- app/views/pages/bash_fill_detail.html.erb -->
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 my-8">
  <h1 class="text-3xl font-bold text-white mb-6 text-center">
    Editar Detalles de Inspecciones Seleccionadas
  </h1>

  <!-- PANEL GLOBAL (aplicar a todos) -->
  <div id="global-panel" class="bg-gray-800 p-6 rounded-lg shadow-md mb-8">
    <h2 class="text-2xl font-bold text-white mb-4">Datos Globales (Aplicar a todos)</h2>
    <!-- Grid de 2 columnas -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

      <!-- Rol N° -->
      <div>
        <label for="global_rol_n" class="block text-gray-300">Rol N°</label>
        <input
          type="text"
          id="global_rol_n"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para Rol N°"
        >
      </div>

      <!-- N° de permiso de edificación -->
      <div>
        <label for="global_numero_permiso" class="block text-gray-300">N° de permiso de edificación</label>
        <input
          type="number"
          id="global_numero_permiso"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para permiso"
        >
      </div>

      <!-- Fecha de permiso de edificación -->
      <div>
        <label for="global_fecha_permiso" class="block text-gray-300">Fecha de permiso de edificación</label>
        <input
          type="date"
          id="global_fecha_permiso"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
        >
      </div>

      <!-- % de ocupación -->
      <div>
        <label for="global_porcentaje" class="block text-gray-300">% de ocupación</label>
        <input
          type="number"
          id="global_porcentaje"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para % de ocupación"
        >
      </div>

      <!-- Destino -->
      <div>
        <label for="global_destino" class="block text-gray-300">Destino</label>
        <select
          id="global_destino"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
        >
          <option value="S/I">S/I</option>
          <option value="Equipamiento">Equipamiento</option>
          <option value="Residencial">Residencial</option>
          <option value="Habitacional (excepto vivienda)">Habitacional (excepto vivienda)</option>
          <option value="Habitacional">Habitacional</option>
          <option value="Infraestructura">Infraestructura</option>
        </select>
      </div>

      <!-- Recepción -->
      <div>
        <label for="global_recepcion" class="block text-gray-300">Recepción</label>
        <input
          type="date"
          id="global_recepcion"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
        >
      </div>

      <!-- Empresa Instaladora RUT -->
      <div>
        <label for="global_empresa_instaladora_rut" class="block text-gray-300">Empresa Instaladora RUT</label>
        <input
          type="text"
          id="global_empresa_instaladora_rut"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para empresa instaladora RUT"
        >
      </div>

      <!-- Empresa Instaladora -->
      <div>
        <label for="global_empresa_instaladora" class="block text-gray-300">Empresa Instaladora</label>
        <input
          type="text"
          id="global_empresa_instaladora"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para empresa instaladora"
        >
      </div>

      <!-- Detalle -->
      <div>
        <label for="global_detalle" class="block text-gray-300">Detalle</label>
        <input
          type="text"
          id="global_detalle"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para detalle"
        >
      </div>

      <!-- Descripción -->
      <div>
        <label for="global_descripcion" class="block text-gray-300">Descripción</label>
        <input
          type="text"
          id="global_descripcion"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para descripción"
        >
      </div>

      <!-- Marca -->
      <div>
        <label for="global_marca" class="block text-gray-300">Marca</label>
        <input
          type="text"
          id="global_marca"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para marca"
        >
      </div>

      <!-- Modelo -->
      <div>
        <label for="global_modelo" class="block text-gray-300">Modelo</label>
        <input
          type="text"
          id="global_modelo"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para modelo"
        >
      </div>

      <!-- Motor Motriz - Marca (mm_marca) -->
      <div>
        <label for="global_mm_marca" class="block text-gray-300">Motor Motriz - Marca</label>
        <input
          type="text"
          id="global_mm_marca"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para motor motriz marca"
        >
      </div>

      <!-- Potencia -->
      <div>
        <label for="global_potencia" class="block text-gray-300">Potencia Kw</label>
        <input
          type="number"
          id="global_potencia"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para potencia"
        >
      </div>

      <!-- Capacidad -->
      <div>
        <label for="global_capacidad" class="block text-gray-300">Capacidad Kg</label>
        <input
          type="number"
          id="global_capacidad"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para capacidad"
        >
      </div>

      <!-- Personas -->
      <div>
        <label for="global_personas" class="block text-gray-300">Personas</label>
        <input
          type="number"
          id="global_personas"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para personas"
        >
      </div>

      <!-- Cables de Tracción - Marca (ct_marca) -->
      <div>
        <label for="global_ct_marca" class="block text-gray-300">Cables de Tracción - Marca</label>
        <input
          type="text"
          id="global_ct_marca"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para ct_marca"
        >
      </div>

      <!-- Cables de Tracción - Cantidad (ct_cantidad) -->
      <div>
        <label for="global_ct_cantidad" class="block text-gray-300">Cables de Tracción - Cantidad</label>
        <input
          type="number"
          id="global_ct_cantidad"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para ct_cantidad"
        >
      </div>

      <!-- Cables de Tracción - Diámetro mm (ct_diametro) -->
      <div>
        <label for="global_ct_diametro" class="block text-gray-300">Cables de Tracción - Diámetro mm</label>
        <input
          type="number"
          id="global_ct_diametro"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para ct_diametro"
        >
      </div>

      <!-- Medidas de cintas - Ancho (mm) -->
      <div>
        <label for="global_medidas_cintas" class="block text-gray-300">Medidas de cintas - Ancho (mm)</label>
        <input
          type="number"
          id="global_medidas_cintas"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para medidas cintas"
        >
      </div>

      <!-- Medidas de cintas - Espesor (mm) -->
      <div>
        <label for="global_medidas_cintas_espesor" class="block text-gray-300">Medidas de cintas - Espesor (mm)</label>
        <input
          type="number"
          id="global_medidas_cintas_espesor"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para medidas cintas espesor"
        >
      </div>

      <!-- Velocidad m/s -->
      <div>
        <label for="global_velocidad" class="block text-gray-300">Velocidad m/s</label>
        <input
          type="number"
          id="global_velocidad"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para velocidad"
        >
      </div>

      <!-- Regulador de Velocidad - Marca (rv_marca) -->
      <div>
        <label for="global_rv_marca" class="block text-gray-300">Regulador de Velocidad - Marca</label>
        <input
          type="text"
          id="global_rv_marca"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para rv_marca"
        >
      </div>

      <!-- Paradas -->
      <div>
        <label for="global_paradas" class="block text-gray-300">Paradas</label>
        <input
          type="number"
          id="global_paradas"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para paradas"
        >
      </div>

      <!-- Embarques -->
      <div>
        <label for="global_embarques" class="block text-gray-300">Embarques</label>
        <input
          type="number"
          id="global_embarques"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
          placeholder="Valor global para embarques"
        >
      </div>

      <!-- Sala de maquinas -->
      <div>
        <label for="global_sala_maquinas" class="block text-gray-300">Sala de maquinas</label>
        <select
          id="global_sala_maquinas"
          class="mt-1 block w-full px-3 py-2 bg-gray-700 text-white rounded-md"
        >
          <option value="Responder más tarde">Responder más tarde</option>
          <option value="Si">Si</option>
          <option value="No. Máquina en la parte superior">No. Máquina en la parte superior</option>
          <option value="No. Máquina en foso">No. Máquina en foso</option>
          <option value="No. Maquinaria fuera de la caja de elevadores">No. Maquinaria fuera de la caja de elevadores</option>
        </select>
      </div>
    </div>

    <button
      type="button"
      id="apply-global"
      class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
    >
      Aplicar a todos
    </button>
  </div>

  <!-- FORMULARIO CARRUSEL -->
  <%= form_with url: "#", id: "multi-detail-form", local: true do |form| %>
    <!-- Controles del carrusel (arriba) -->
    <div class="carousel-controls flex justify-between mb-4">
      <button
        type="button"
        id="prev-btn-top"
        class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded"
      >
        Anterior
      </button>
      <button
        type="button"
        id="next-btn-top"
        class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded"
      >
        Siguiente
      </button>
    </div>

    <!-- Contenedor del carrusel -->
    <div id="inspections-container" class="relative min-h-[500px]">
      <% @inspections.each_with_index do |inspection, index| %>
        <% detail = inspection.item.detail || Detail.new %>
        <div
          class="inspection-detail absolute inset-0 transition-opacity duration-300 <%= index == 0 ? 'active' : 'hidden' %>"
          data-inspection-number="<%= inspection.number %>"
        >
          <!-- Fondo y padding del detalle -->
          <div class="bg-gray-900 p-6 rounded-lg shadow-md h-full overflow-y-auto">
            <h2 class="text-2xl font-bold text-white mb-6">
              Detalle para Inspección N° <%= inspection.number %>
            </h2>

            <!-- Grid de 2 columnas para el detalle -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

              <!-- Rol N° -->
              <div>
                <label class="block text-gray-300">Rol N°</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.text_field "details[#{inspection.number}][rol_n]",
                                      maxlength: 100,
                                      class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                      value: detail.rol_n,
                                      id: "detail_#{inspection.number}_rol_n" %>
                  <!-- Checkbox "Aplicar" -->
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="rol_n"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- N° de permiso de edificación -->
              <div>
                <label class="block text-gray-300">N° de permiso de edificación</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.number_field "details[#{inspection.number}][numero_permiso]",
                                        max: 1000000000,
                                        min: 0,
                                        class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                        value: detail.numero_permiso,
                                        id: "detail_#{inspection.number}_numero_permiso" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="numero_permiso"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Fecha de permiso de edificación -->
              <div>
                <label class="block text-gray-300">Fecha de permiso de edificación</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.date_field "details[#{inspection.number}][fecha_permiso]",
                                      class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                      value: detail.fecha_permiso,
                                      id: "detail_#{inspection.number}_fecha_permiso" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="fecha_permiso"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- % de ocupación -->
              <div>
                <label class="block text-gray-300">% de ocupación</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.number_field "details[#{inspection.number}][porcentaje]",
                                        max: 100,
                                        min: 0,
                                        class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                        value: detail.porcentaje,
                                        id: "detail_#{inspection.number}_porcentaje" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="porcentaje"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Destino -->
              <div>
                <label class="block text-gray-300">Destino</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.select "details[#{inspection.number}][destino]",
                                  options_for_select([
                                                       ['S/I', 'S/I'],
                                                       ['Equipamiento', 'Equipamiento'],
                                                       ['Residencial', 'Residencial'],
                                                       ['Habitacional (excepto vivienda)', 'Habitacional (excepto vivienda)'],
                                                       ['Habitacional', 'Habitacional'],
                                                       ['Infraestructura', 'Infraestructura']],
                                                     detail.destino.present? ? detail.destino : 'S/I'),
                                  {},
                                  class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                  id: "detail_#{inspection.number}_destino" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="destino"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Recepción -->
              <div>
                <label class="block text-gray-300">Recepción</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.date_field "details[#{inspection.number}][recepcion]",
                                      class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                      value: detail.recepcion,
                                      id: "detail_#{inspection.number}_recepcion" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="recepcion"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Empresa Instaladora RUT -->
              <div>
                <label class="block text-gray-300">Empresa Instaladora RUT</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.text_field "details[#{inspection.number}][empresa_instaladora_rut]",
                                      data: { controller: "rut", rut_target: "rut" },
                                      maxlength: 100,
                                      class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                      value: detail.empresa_instaladora_rut,
                                      id: "detail_#{inspection.number}_empresa_instaladora_rut" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="empresa_instaladora_rut"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Empresa Instaladora -->
              <div>
                <label class="block text-gray-300">Empresa Instaladora</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.text_field "details[#{inspection.number}][empresa_instaladora]",
                                      data: { controller: "titleize", action: "input->titleize#updateInput", titleize_target: "input" },
                                      maxlength: 100,
                                      class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                      value: detail.empresa_instaladora,
                                      id: "detail_#{inspection.number}_empresa_instaladora" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="empresa_instaladora"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Detalle -->
              <div>
                <label class="block text-gray-300">Detalle</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.text_field "details[#{inspection.number}][detalle]",
                                      data: { controller: "capitalize", action: "input->capitalize#capitalizeFirstLetter", capitalize_target: "input" },
                                      maxlength: 100,
                                      class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                      value: detail.detalle,
                                      id: "detail_#{inspection.number}_detalle" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="detalle"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Descripción -->
              <div>
                <label class="block text-gray-300">Descripción</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.text_field "details[#{inspection.number}][descripcion]",
                                      data: { controller: "capitalize", action: "input->capitalize#capitalizeFirstLetter", capitalize_target: "input" },
                                      maxlength: 100,
                                      class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                      value: detail.descripcion,
                                      id: "detail_#{inspection.number}_descripcion" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="descripcion"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Marca -->
              <div>
                <label class="block text-gray-300">Marca</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.text_field "details[#{inspection.number}][marca]",
                                      data: { controller: "capitalize", action: "input->capitalize#capitalizeFirstLetter", capitalize_target: "input" },
                                      maxlength: 100,
                                      class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                      value: detail.marca,
                                      id: "detail_#{inspection.number}_marca" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="marca"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Modelo -->
              <div>
                <label class="block text-gray-300">Modelo</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.text_field "details[#{inspection.number}][modelo]",
                                      data: { controller: "capitalize", action: "input->capitalize#capitalizeFirstLetter", capitalize_target: "input" },
                                      maxlength: 100,
                                      class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                      value: detail.modelo,
                                      id: "detail_#{inspection.number}_modelo" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="modelo"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- N° de serie (sin checkbox) -->
              <div class="col-span-2">
                <label class="block text-gray-300">N° de serie</label>
                <%= form.text_field "details[#{inspection.number}][n_serie]",
                                    data: { controller: "uppercase", uppercase_target: "input" },
                                    maxlength: 100,
                                    class: "mt-1 block w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                    value: detail.n_serie,
                                    id: "detail_#{inspection.number}_n_serie" %>
              </div>

              <!-- Motor Motriz - Marca (mm_marca) -->
              <div>
                <label class="block text-gray-300">Motor Motriz - Marca</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.text_field "details[#{inspection.number}][mm_marca]",
                                      data: { controller: "capitalize", action: "input->capitalize#capitalizeFirstLetter", capitalize_target: "input" },
                                      maxlength: 100,
                                      class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                      value: detail.mm_marca,
                                      id: "detail_#{inspection.number}_mm_marca" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="mm_marca"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Motor Motriz - N° de serie (sin checkbox) -->
              <div>
                <label class="block text-gray-300">Motor Motriz - N° de serie</label>
                <%= form.text_field "details[#{inspection.number}][mm_n_serie]",
                                    data: { controller: "uppercase", uppercase_target: "input" },
                                    maxlength: 100,
                                    class: "mt-1 block w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                    value: detail.mm_n_serie,
                                    id: "detail_#{inspection.number}_mm_n_serie" %>
              </div>

              <!-- Potencia Kw -->
              <div>
                <label class="block text-gray-300">Potencia Kw</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.number_field "details[#{inspection.number}][potencia]",
                                        max: 1000000,
                                        min: 0,
                                        step: 0.00001,
                                        class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                        value: detail.potencia,
                                        id: "detail_#{inspection.number}_potencia" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="potencia"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Capacidad Kg -->
              <div>
                <label class="block text-gray-300">Capacidad Kg</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.number_field "details[#{inspection.number}][capacidad]",
                                        max: 1000000,
                                        min: 0,
                                        class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                        value: detail.capacidad,
                                        id: "detail_#{inspection.number}_capacidad" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="capacidad"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Personas -->
              <div>
                <label class="block text-gray-300">Personas</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.number_field "details[#{inspection.number}][personas]",
                                        max: 1000000,
                                        min: 0,
                                        class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                        value: detail.personas,
                                        id: "detail_#{inspection.number}_personas" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="personas"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Cables de Tracción - Marca -->
              <div>
                <label class="block text-gray-300">Cables de Tracción - Marca</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.text_field "details[#{inspection.number}][ct_marca]",
                                      data: { controller: "capitalize", action: "input->capitalize#capitalizeFirstLetter", capitalize_target: "input" },
                                      maxlength: 100,
                                      class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                      value: detail.ct_marca,
                                      id: "detail_#{inspection.number}_ct_marca" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="ct_marca"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Cables de Tracción - Cantidad -->
              <div>
                <label class="block text-gray-300">Cables de Tracción - Cantidad</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.number_field "details[#{inspection.number}][ct_cantidad]",
                                        max: 1000000,
                                        min: 0,
                                        class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                        value: detail.ct_cantidad,
                                        id: "detail_#{inspection.number}_ct_cantidad" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="ct_cantidad"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Cables de Tracción - Diámetro mm -->
              <div>
                <label class="block text-gray-300">Cables de Tracción - Diámetro mm</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.number_field "details[#{inspection.number}][ct_diametro]",
                                        max: 1000000,
                                        min: 0,
                                        step: 0.00001,
                                        class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                        value: detail.ct_diametro,
                                        id: "detail_#{inspection.number}_ct_diametro" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="ct_diametro"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Ancho Medidas de cintas mm -->
              <div>
                <label class="block text-gray-300">Ancho Medidas de cintas mm</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.number_field "details[#{inspection.number}][medidas_cintas]",
                                        max: 1000000,
                                        min: 0,
                                        step: 0.0001,
                                        class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                        value: detail.medidas_cintas,
                                        id: "detail_#{inspection.number}_medidas_cintas" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="medidas_cintas"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Espesor Medidas de cintas mm -->
              <div>
                <label class="block text-gray-300">Espesor Medidas de cintas mm</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.number_field "details[#{inspection.number}][medidas_cintas_espesor]",
                                        max: 1000000,
                                        min: 0,
                                        step: 0.0001,
                                        class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                        value: detail.medidas_cintas_espesor,
                                        id: "detail_#{inspection.number}_medidas_cintas_espesor" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="medidas_cintas_espesor"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Velocidad m/s -->
              <div>
                <label class="block text-gray-300">Velocidad m/s</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.number_field "details[#{inspection.number}][velocidad]",
                                        max: 1000000,
                                        min: 0,
                                        step: 0.0001,
                                        class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                        value: detail.velocidad,
                                        id: "detail_#{inspection.number}_velocidad" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="velocidad"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Regulador de Velocidad - Marca -->
              <div>
                <label class="block text-gray-300">Regulador de Velocidad - Marca</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.text_field "details[#{inspection.number}][rv_marca]",
                                      data: { controller: "capitalize", action: "input->capitalize#capitalizeFirstLetter", capitalize_target: "input" },
                                      maxlength: 100,
                                      class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                      value: detail.rv_marca,
                                      id: "detail_#{inspection.number}_rv_marca" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="rv_marca"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- N° serie (Regulador de Velocidad) - sin checkbox -->
              <div>
                <label class="block text-gray-300">N° serie (Regulador)</label>
                <%= form.text_field "details[#{inspection.number}][rv_n_serie]",
                                    data: { controller: "uppercase", uppercase_target: "input" },
                                    maxlength: 100,
                                    class: "mt-1 block w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                    value: detail.rv_n_serie,
                                    id: "detail_#{inspection.number}_rv_n_serie" %>
              </div>

              <!-- Paradas -->
              <div>
                <label class="block text-gray-300">Paradas</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.number_field "details[#{inspection.number}][paradas]",
                                        max: 1000000,
                                        min: 0,
                                        class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                        value: detail.paradas,
                                        id: "detail_#{inspection.number}_paradas" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="paradas"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Embarques -->
              <div>
                <label class="block text-gray-300">Embarques</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.number_field "details[#{inspection.number}][embarques]",
                                        max: 1000000,
                                        min: 0,
                                        class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                        value: detail.embarques,
                                        id: "detail_#{inspection.number}_embarques" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="embarques"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Sala de maquinas -->
              <div>
                <label class="block text-gray-300">Sala de maquinas</label>
                <div class="flex items-center space-x-2 mt-1">
                  <%= form.select "details[#{inspection.number}][sala_maquinas]",
                                  ["Responder más tarde", "Si", "No. Máquina en la parte superior", "No. Máquina en foso", "No. Maquinaria fuera de la caja de elevadores"],
                                  {},
                                  class: "w-full px-3 py-2 bg-gray-800 text-white rounded-md",
                                  selected: detail.sala_maquinas,
                                  id: "detail_#{inspection.number}_sala_maquinas" %>
                  <label class="flex items-center space-x-1 text-white">
                    <input
                      type="checkbox"
                      class="apply-global-checkbox"
                      data-field="sala_maquinas"
                      data-inspection="<%= inspection.number %>"
                      checked
                    >
                    <span class="text-sm">Aplicar</span>
                  </label>
                </div>
              </div>

              <!-- Hidden fields -->
              <%= hidden_field_tag "details[#{inspection.number}][closed]", params[:closed] || false %>
              <%= hidden_field_tag "details[#{inspection.number}][inspection_origin]", inspection.number %>
            </div> <!-- Fin grid 2 columnas -->
          </div> <!-- Fin .bg-gray-900 p-6 -->
        </div> <!-- Fin .inspection-detail -->
      <% end %>
    </div>

    <!-- Controles del carrusel (abajo) -->
    <div class="carousel-controls flex justify-between mt-4">
      <button
        type="button"
        id="prev-btn-bottom"
        class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded"
      >
        Anterior
      </button>
      <button
        type="button"
        id="next-btn-bottom"
        class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded"
      >
        Siguiente
      </button>
    </div>

    <!-- Botón final de "Guardar información" -->
    <div class="mt-6">
      <button
        type="button"
        id="multi-submit-button"
        class="w-full bg-blue-600 hover:bg-blue-700 text-gray-900 font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
      >
        Guardar información
      </button>
    </div>
  <% end %>
</div>

<!-- Estilos para el carrusel -->
<style>
    #inspections-container {
        position: relative;
        min-height: 500px; /* Ajusta según tu preferencia */
    }
    .inspection-detail {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
    .inspection-detail.active {
        display: block;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Referencias a todos los .inspection-detail
        let details = document.querySelectorAll('.inspection-detail');
        let currentIndex = 0;

        if (details.length > 0) {
            details[currentIndex].classList.add('active');
        }

        // Botones "Anterior" / "Siguiente" (arriba)
        const prevBtnTop = document.getElementById('prev-btn-top');
        const nextBtnTop = document.getElementById('next-btn-top');

        // Botones "Anterior" / "Siguiente" (abajo)
        const prevBtnBottom = document.getElementById('prev-btn-bottom');
        const nextBtnBottom = document.getElementById('next-btn-bottom');

        function updateCarouselControls() {
            let prevIndex = (currentIndex - 1 + details.length) % details.length;
            let nextIndex = (currentIndex + 1) % details.length;
            let prevInspeccion = details[prevIndex].getAttribute('data-inspection-number');
            let nextInspeccion = details[nextIndex].getAttribute('data-inspection-number');

            // Actualiza texto de los 4 botones
            if (prevBtnTop) {
                prevBtnTop.textContent = `Anterior (Inspección Nº ${prevInspeccion})`;
            }
            if (nextBtnTop) {
                nextBtnTop.textContent = `Siguiente (Inspección Nº ${nextInspeccion})`;
            }
            if (prevBtnBottom) {
                prevBtnBottom.textContent = `Anterior (Inspección Nº ${prevInspeccion})`;
            }
            if (nextBtnBottom) {
                nextBtnBottom.textContent = `Siguiente (Inspección Nº ${nextInspeccion})`;
            }
        }
        updateCarouselControls();

        // Funciones para navegar
        function showPrev() {
            details[currentIndex].classList.remove('active');
            currentIndex = (currentIndex - 1 + details.length) % details.length;
            details[currentIndex].classList.add('active');
            updateCarouselControls();
        }
        function showNext() {
            details[currentIndex].classList.remove('active');
            currentIndex = (currentIndex + 1) % details.length;
            details[currentIndex].classList.add('active');
            updateCarouselControls();
        }

        // Listeners de los 4 botones
        if (prevBtnTop)    prevBtnTop.addEventListener('click', showPrev);
        if (nextBtnTop)    nextBtnTop.addEventListener('click', showNext);
        if (prevBtnBottom) prevBtnBottom.addEventListener('click', showPrev);
        if (nextBtnBottom) nextBtnBottom.addEventListener('click', showNext);

        // ================
        // APLICAR A TODOS
        // ================
        document.getElementById('apply-global').addEventListener('click', function() {
            // Lista de campos globales (excluye n_serie, mm_n_serie, rv_n_serie)
            const globalFields = [
                'rol_n', 'numero_permiso', 'fecha_permiso', 'porcentaje', 'destino', 'recepcion',
                'empresa_instaladora_rut', 'empresa_instaladora', 'detalle', 'descripcion', 'marca', 'modelo',
                'mm_marca', 'potencia', 'capacidad', 'personas',
                'ct_marca', 'ct_cantidad', 'ct_diametro', 'medidas_cintas', 'medidas_cintas_espesor',
                'velocidad', 'rv_marca', 'paradas', 'embarques', 'sala_maquinas'
            ];
            globalFields.forEach(function(field) {
                const globalInput = document.getElementById('global_' + field);
                if (globalInput) {
                    const globalValue = globalInput.value.trim();
                    // No se considera reemplazo si el valor global está vacío o es "S/I"
                    if (!globalValue || globalValue === "S/I") return;

                    const checkboxes = document.querySelectorAll('input.apply-global-checkbox[data-field="'+field+'"]');
                    let warnings = [];
                    checkboxes.forEach(function(checkbox) {
                        if (checkbox.checked) {
                            const inspection = checkbox.getAttribute('data-inspection');
                            const detailInput = document.getElementById('detail_' + inspection + '_' + field);
                            if (detailInput) {
                                let currentVal = detailInput.value.trim();
                                if (detailInput.tagName.toLowerCase() === 'select') {
                                    currentVal = currentVal.toLowerCase();
                                    if (currentVal && currentVal !== "s/i" && currentVal !== globalValue.toLowerCase()) {
                                        warnings.push(inspection);
                                    }
                                } else {
                                    if (currentVal && currentVal !== "S/I" && currentVal !== globalValue) {
                                        warnings.push(inspection);
                                    }
                                }
                            }
                        }
                    });

                    if (warnings.length > 0) {
                        Swal.fire({
                            title: 'Advertencia',
                            text: 'El campo "' + field + '" en las inspecciones [' + warnings.join(', ') + '] ya tiene un valor diferente. ¿Desea sobrescribirlo?',
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonText: 'Sobrescribir',
                            cancelButtonText: 'No sobrescribir'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                checkboxes.forEach(function(checkbox) {
                                    if (checkbox.checked) {
                                        const inspection = checkbox.getAttribute('data-inspection');
                                        const detailInput = document.getElementById('detail_' + inspection + '_' + field);
                                        if (detailInput) {
                                            detailInput.value = globalValue;
                                        }
                                    }
                                });
                            }
                        });
                    } else {
                        checkboxes.forEach(function(checkbox) {
                            if (checkbox.checked) {
                                const inspection = checkbox.getAttribute('data-inspection');
                                const detailInput = document.getElementById('detail_' + inspection + '_' + field);
                                if (detailInput) {
                                    detailInput.value = globalValue;
                                }
                            }
                        });
                    }
                }
            });
        });

        // ========================
        // GUARDAR INFORMACIÓN
        // ========================
        const submitButton = document.getElementById('multi-submit-button');
        submitButton.addEventListener('click', function(event) {
            event.preventDefault();
            const form = document.getElementById('multi-detail-form');
            const formData = new FormData(form);
            let data = {};
            formData.forEach((value, key) => {
                if (data[key]) {
                    if (Array.isArray(data[key])) {
                        data[key].push(value);
                    } else {
                        data[key] = [data[key], value];
                    }
                } else {
                    data[key] = value;
                }
            });
            Swal.fire({
                title: 'Información a enviar',
                html: `<pre>${JSON.stringify(data, null, 2)}</pre>`,
                icon: 'info',
                confirmButtonText: 'OK'
            });
        });
    });
</script>
